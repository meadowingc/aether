{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🌌</text></svg>"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, noarchive" />
    <script>
      // Apply saved theme or default to dark as early as possible to avoid flashes
      (function () {
        try {
          var t = localStorage.getItem("aether_theme");
          document.documentElement.setAttribute(
            "data-theme",
            t === "light" || t === "dark" ? t : "dark"
          );
        } catch (e) {
          // If localStorage is not accessible, still default to dark
          document.documentElement.setAttribute("data-theme", "dark");
        }
      })();
    </script>
    <link rel="stylesheet" href="{% static 'aether_notes/style.css' %}" />
    <title>{% block title %}Aether{% endblock %}</title>
    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <header class="site-header">
      <h1><a href="{% url 'index' %}">🌌 Aether</a></h1>
      <div class="header-actions">
        <button
          id="theme_toggle"
          class="theme-toggle"
          aria-label="Toggle theme"
          title="Toggle theme"
        >
          🌙
        </button>
        {% if request.user.is_authenticated %}
          <span class="user-pill">👤 {{ request.user.username }}</span>
          <a class="about-link" href="{% url 'accounts:settings' %}">Settings</a>
          <a class="about-link" href="{% url 'logout' %}">Logout</a>
        {% else %}
          <a class="about-link" href="{% url 'about' %}">About</a>
          <a class="about-link" href="{% url 'two_factor:login' %}">Login</a>
          <a class="about-link" href="{% url 'accounts:register' %}">Register</a>
        {% endif %}
      </div>
    </header>

    {% if messages %}
    <div class="messages">
      <ul>
        {% for m in messages %}
          <li class="msg {{ m.tags }}">{{ m }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}
    <main class="container">{% block content %}{% endblock %}</main>
    <script>
      (function () {
        var btn = document.getElementById("theme_toggle");
        if (!btn) return;
        function current() {
          return document.documentElement.getAttribute("data-theme") || "dark";
        }
        function setTheme(t) {
          document.documentElement.setAttribute("data-theme", t);
          try {
            localStorage.setItem("aether_theme", t);
          } catch (e) {}
          btn.textContent = t === "dark" ? "🌙" : "☀️";
        }
        // init icon
        setTheme(current());
        btn.addEventListener("click", function () {
          setTheme(current() === "dark" ? "light" : "dark");
        });
      })();
    </script>
    {% block scripts %}{% endblock %}
  </body>
</html>
